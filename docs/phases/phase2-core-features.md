# Phase 2: コア機能実装

**ステータス**: ⚪ 未着手
**開始予定日**: Phase 1完了後
**目標完了日**: TBD

## 概要
スケジュール管理、配信実行、通知などのコア機能を実装するフェーズです。

## 主要目標
- [ ] スケジュール管理機能の実装
- [ ] スケジューラー実行エンジンの実装
- [ ] プレイリストループ再生機能の実装
- [ ] ログ記録機能の実装
- [ ] Slack通知機能の実装

## タスク一覧

### 1. スケジュールデータモデル設計
**ステータス**: ⚪ 未着手
**推奨エージェント**: `@scheduler`

#### サブタスク
- [ ] スケジュールデータ構造の設計
- [ ] データスキーマ定義
- [ ] バリデーションルールの定義
- [ ] サンプルデータの作成

#### 成果物
- [ ] `src/scheduler/types.ts` - 型定義
- [ ] `docs/data-schema.md` - データスキーマ仕様

### 2. スケジュール管理モジュール実装
**ステータス**: ⚪ 未着手
**推奨エージェント**: `@scheduler`

#### サブタスク
- [ ] スケジュールCRUD操作の実装
- [ ] データ永続化の実装（JSON or SQLite）
- [ ] スケジュール検索・フィルタリング
- [ ] スケジュール一覧取得

#### 成果物
- [ ] `src/scheduler/manager.ts` - スケジュール管理
- [ ] `src/scheduler/storage.ts` - データ永続化
- [ ] `tests/scheduler/manager.test.ts` - テスト

### 3. 時間重複チェック機能
**ステータス**: ⚪ 未着手
**推奨エージェント**: `@scheduler`

#### サブタスク
- [ ] 重複検知アルゴリズムの実装
- [ ] 重複時のエラーメッセージ
- [ ] 許容範囲の設定（バッファ時間）

#### 成果物
- [ ] `src/scheduler/overlap-checker.ts` - 重複チェック
- [ ] `tests/scheduler/overlap-checker.test.ts` - テスト

### 4. スケジューラー実行エンジン実装
**ステータス**: ⚪ 未着手
**推奨エージェント**: `@scheduler`

#### サブタスク
- [ ] スケジュール監視ループの実装
- [ ] 実行タイミングの判定
- [ ] 配信タスクの起動
- [ ] 実行状態の管理
- [ ] エラー時のリトライロジック

#### 成果物
- [ ] `src/scheduler/executor.ts` - 実行エンジン
- [ ] `tests/scheduler/executor.test.ts` - テスト

### 5. プレイリストループ再生機能
**ステータス**: ⚪ 未着手
**推奨エージェント**: `@browser-automation`

#### サブタスク
- [ ] プレイリスト終了検知の実装
- [ ] プレイリスト再選択の実装
- [ ] ループ回数のカウント
- [ ] 終了時刻チェックとループ停止

#### 成果物
- [ ] `src/browser/playlist-loop.ts` - ループ再生
- [ ] `tests/browser/playlist-loop.test.ts` - テスト

### 6. ログ記録機能
**ステータス**: ⚪ 未着手

#### サブタスク
- [ ] ロガーの初期設定（winston or pino）
- [ ] ログレベルの設定
- [ ] ログフォーマットの定義
- [ ] ログローテーション設定
- [ ] ログファイルの保存場所設定

#### 成果物
- [ ] `src/logger/logger.ts` - ロガー設定
- [ ] `src/logger/transports.ts` - ログ出力先設定

### 7. Slack通知機能
**ステータス**: ⚪ 未着手

#### サブタスク
- [ ] Slack Webhook設定
- [ ] 通知メッセージのフォーマット設計
- [ ] エラー通知の実装
- [ ] 配信開始/終了通知の実装（オプション）
- [ ] 通知レベルの設定

#### 成果物
- [ ] `src/notification/slack.ts` - Slack通知
- [ ] `tests/notification/slack.test.ts` - テスト

### 8. 配信実行オーケストレーション
**ステータス**: ⚪ 未着手

#### サブタスク
- [ ] 配信開始から終了までの全体フローの実装
- [ ] ブラウザ自動化とスケジューラーの統合
- [ ] エラーハンドリングの統合
- [ ] ログとSlack通知の統合

#### 成果物
- [ ] `src/orchestrator/stream-orchestrator.ts` - オーケストレーター
- [ ] `tests/orchestrator/` - 統合テスト

## ブロッカー・課題

### 依存関係
- Phase 1の完了が必須
- ブラウザ自動化の基本実装が完了していること

### 技術的課題
1. スケジュール実行の正確性とタイミング
2. 長時間運用時の安定性
3. エラー時の復旧処理

## 次のフェーズへの移行条件
- [ ] 全タスクの完了
- [ ] 統合テストの成功
- [ ] スケジュール実行の動作確認
- [ ] エラー通知の動作確認

## 更新履歴
- 2025-11-11: Phase 2タスク定義作成
